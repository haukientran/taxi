function setDetail(e){str='<p class="image_name">'+e.name+"</p><p>"+text_size+": "+e.size+"</p><p>"+text_created+": "+e.created+"</p><p>"+text_updated+": "+e.updated+'</p><input type="text" name="title" value="'+e.title+'" placeholder="'+text_title+'"><textarea rows="2" name="caption" placeholder="'+text_desc+'">'+e.caption+'</textarea><button type="button" class="btn btn-media btn-active" data-id="'+e.id+'" id="save_info_image">'+text_save+'</button><button type="button" class="btn btn-media" data-id="'+e.id+'" id="check_delete">'+text_delete+"</button>",$(".media-content__main-detail__thumb").empty().append('<img src="'+e.image+'" alt="">'),$(".media-content__main-detail__desc").empty().append(str)}function setDetailEmpty(){$(".media-content__main-detail__thumb").empty().append('<i class="fa fa-image"></i>'),$(".media-content__main-detail__desc").empty().append("<p>"+no_choose_image+"</p>")}function checkEmptyImage(){0==$(".media-content__main-list .item").length&&$(".media-content__main-list").empty().append('<div class="media-content__main-list__upload"><i class="fa fa-cloud-upload icon"></i><label for="file" class="inputfile" files selected">'+no_image+"</label></div>")}function loadModal(e){$("#modal-comfirm .modal-title").empty().text(e.title),$("#modal-comfirm .modal-body").empty().append('<p style="line-height: 22px;">'+e.text+"</p>"),"true"==e.close?$("#modal-comfirm .modal-footer").empty().append('<button type="button" class="btn btn-media btn-active" data-dismiss="modal">'+upload_close+"</button>"):$("#modal-comfirm .modal-footer").empty().append(e.footer),$("#modal-comfirm").modal()}function in_array(e,a){for(var t=!1,i=0;i<a.length;i++){if(a[i]==e){t=!0;break}}return t}function upload_file(e){check_size=0,check_extension=0,$.each(e,function(e,a){a.size>max_size_file&&(check_size=1),extension=a.name.substr(a.name.lastIndexOf(".")+1),allowed_image=allowed_extension_image.split(","),allowed_file=allowed_extension_file.split(","),allowed_array=$.merge(allowed_image,allowed_file),in_array(extension,allowed_array)||(check_extension=1)}),1==check_size?(data_model={title:upload,text:upload_size_fail,close:"true"},loadModal(data_model),$("#file").val("")):1==check_extension?(text=upload_ext_fail+": "+allowed_extension_image+","+allowed_extension_file,data_model={title:upload,text:text,close:"true"},loadModal(data_model),$("#file").val("")):(count=e.length,$(".media-content__main-list__upload").length>0&&$(".media-content__main-list").empty(),count>0&&($.each(e,function(e,a){image_preview=URL.createObjectURL(a),name=a.name,size=formatSizeUnits(a.size),time=getCurentTime(),str='<div class="item upload_waiting" data-index="'+e+'"><div class="item-image"><img src="'+image_preview+'" alt=""></div><div class="item-info"><p class="item-info__name">'+name+'</p><p class="item-info__size">'+text_size+": "+size+'</p><p class="item-info__created">'+text_created+": "+time+'</p><p class="item-info__updated">'+text_updated+": "+time+'</p><p class="item-info__created">'+uploading+"</p></div></div>",$(".media-content__main-list").prepend(str)}),data_error=[],id_success=[],$.each(e,function(e,a){var t=new FormData;t.append("files",a),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:url,data:t,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){$(".item[data-index="+e+"]").removeClass("upload_waiting").addClass("uploading")},success:function(a){1==a.status?($(".item[data-index="+e+"]").removeClass("uploading").addClass("upload_success"),id_success.push(a.media_id)):(data_error.push(a.message),$(".item[data-index="+e+"]").removeClass("uploading").addClass("upload_fail"))},error:function(a){a.responseJSON.message?text=a.responseJSON.message:text=a.responseText,data_error.push(text),$(".item[data-index="+e+"]").removeClass("uploading").addClass("upload_fail")}})}),load_ajax=!1,$(document).ajaxStop(function(){load_ajax=!0}),load_interval=setInterval(function(){1==load_ajax&&(setTimeout(function(){loadImage(optimizeUrl()),id_success.length>0&&setTimeout(function(){type=getUrlParameter(url,"uploads"),choose_one=!0,"multiple"==type&&(choose_one=!1),1==choose_one?$(".item[data-id="+id_success[id_success.length-1]+"]").click():$.each(id_success,function(e,a){$(".item[data-id="+a+"]").click()})},1e3)},2e3),load_ajax=!1,clearInterval(load_interval),data_error.length>0&&(str_error="",$.each(data_error,function(e,a){str_error+=a+"<br>"}),data_model={title:"Upload Fail",text:str_error,close:"true"},loadModal(data_model)))})),$("#file").val(""))}function loadImage(e){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"GET",url:e,beforeSend:function(){},success:function(a){history.pushState(null,null,e),setLoadFile(a)},error:function(e){alert("Có lỗi xảy ra!")}})}function loadImageLoading(e){loadAjaxGet(e,{beforeSend:function(){},success:function(a){history.pushState(null,null,e),setLoadFile(a)},error:function(e){}})}function setLoadFile(e){$(".media-content__main-list").empty().append(e.data),$(".media-content__main-pagination").empty().append(e.paginate),setDetailEmpty()}function optimizeUrl(e,a,t){param_array=[],search=decodeURI(window.location.search).replace("?","").replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"'),url_param={},""!=search&&(url_param=JSON.parse('{"'+search+'"}')),checkEmpty(e)||(url_param.page=e),checkEmpty(a)||(url_param.filter=a),checkEmpty(t)||(url_param.type=t);for(var i in url_param)url_param.hasOwnProperty(i)&&param_array.push(encodeURIComponent(i)+"="+encodeURIComponent(url_param[i]));return str_param=param_array.join("&"),url_load=url_not_param+"?"+str_param,url_load}url=window.location.href,url_not_param=window.location.origin+window.location.pathname,uploads=getUrlParameter(url,"uploads"),$(document).ready(function(){loadImageLoading(url),$("body").on("click",".media-content__main-list .item",function(){return!$(this).hasClass("upload_waiting")&&(!$(this).hasClass("uploading")&&(!$(this).hasClass("upload_success")&&(!$(this).hasClass("upload_fail")&&void($(this).hasClass("active")?($(this).removeClass("active"),setDetailEmpty()):("multiple"!=uploads&&$(".media-content__main-list .item").removeClass("active"),$(this).addClass("active"),id=$(this).data("id"),url_file=$(this).data("url"),image=$(this).data("image"),name=$(this).data("name"),size=$(this).data("size"),created=$(this).data("created"),updated=$(this).data("updated"),title=$(this).data("title"),caption=$(this).data("caption"),data={id:id,url_file:url_file,image:image,name:name,size:size,created:created,updated:updated,title:title,caption:caption},setDetail(data))))))}),$("body").on("click","*[data-search_btn]",function(e){e.preventDefault(),keyword=$("input[name=keyword]").val(),pushOrUpdate({name:keyword}),loadImageLoading(window.location.href)}),$("body").on("click","#check_delete",function(){id=$(this).data("id"),data_model={title:delete_title,text:delete_comfirm,footer:'<button type="button" class="btn btn-media btn-active" data-delete_image data-id="'+id+'">'+text_delete+'</button><button type="button" class="btn btn-media" data-dismiss="modal">'+text_no+"</button>"},loadModal(data_model)}),$("body").on("click","*[data-delete_image]",function(){id=$(this).data("id"),$("#modal-comfirm").modal("hide"),item_box=$(".item[data-id="+id+"]"),formData={_token:$('meta[name="csrf-token"]').attr("content"),_method:"DELETE",id:id},LoadAjaxPost(url_not_param+"/"+id,formData,{beforeSend:function(){item_box.addClass("uploading")},success:function(e){item_box.fadeOut(function(){$(this).remove(),checkEmptyImage()})},error:function(e){}})}),$("body").on("click","#save_info_image",function(){id=$(this).data("id"),title=$(this).parent().children("input[name=title]").val(),caption=$(this).parent().children("textarea[name=caption]").val(),$(".item[data-id="+id+"]").data("title",title),$(".item[data-id="+id+"]").data("caption",caption),""!=title?$(".item[data-id="+id+"]").find(".item-info__title").css("display","block").html(text_title+": "+title):$(".item[data-id="+id+"]").find(".item-info__title").css("display","none").html(null),""!=caption?$(".item[data-id="+id+"]").find(".item-info__caption").css("display","block").html(text_desc+": "+caption):$(".item[data-id="+id+"]").find(".item-info__caption").css("display","none").html(null),formData={_token:$('meta[name="csrf-token"]').attr("content"),_method:"PUT",id:id,title:title,caption:caption},LoadAjaxPost(url_not_param+"/"+id,formData,{beforeSend:function(){},success:function(e){data_model={title:update_title,text:update_success,close:"true"},loadModal(data_model)},error:function(e){}})}),$("body").on("click",'*[data-type="type"]',function(e){e.preventDefault(),value=$(this).data("value"),$('*[data-type="type"]').removeClass("active"),$(this).addClass("active"),url_load=optimizeUrl(null,null,value),loadImageLoading(url_load)}),$("body").on("click",'*[data-type="filter"]',function(e){e.preventDefault(),value=$(this).data("value"),$('*[data-type="filter"]').removeClass("active"),$(this).addClass("active"),url_load=optimizeUrl(null,value,null),loadImageLoading(url_load)}),$("body").on("click","*[data-reload]",function(){loadImageLoading(optimizeUrl(null,null,null))}),$("#file").on("change",function(){file=this.files,upload_file(file)}),$(".media-content__main-list__upload").on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){$(".media-content__main-list__upload").addClass("upload_active")}).on("dragleave dragend drop",function(){$(".media-content__main-list__upload").removeClass("upload_active")}).on("drop",function(e){droppedFiles=e.originalEvent.dataTransfer.files,upload_file(droppedFiles)}),$(".media-content__main-pagination").on("click","a.page-link",function(e){e.preventDefault(),href=$(this).attr("href"),page=getUrlParameter(href,"page"),url_load=optimizeUrl(page,null,null),loadImageLoading(url_load)}),$("body").on("click","*[data-insert]",function(){switch(type=getUrlParameter(url,"uploads"),field_id=getUrlParameter(url,"field_id"),type){case"direct":$(".item.active").each(function(e){name=$(this).data("name"),url_file=$(this).data("url"),image=$(this).data("image"),created_at=$(this).data("created_at"),window.parent.$("#"+field_id).attr("src",image),window.parent.$("#input-"+field_id).val(url_file)});break;case"single":$(".item.active").each(function(e){name=$(this).data("name"),url_file=$(this).data("url"),image=$(this).data("image"),created_at=$(this).data("created_at"),window.parent.$("#"+field_id+"_box").empty().append('<div class="item" data-delete_box><img src="'+image+'" alt=""><input type="hidden" value="'+url_file+'" name="'+field_id+'"><span class="item-delete" data-delete_noremove><i class="fa fa-trash"></i></span></div>'),window.parent.$("#"+field_id+"_box").find(".error").remove()});break;case"multiple":$(".item.active").each(function(e){name=$(this).data("name"),url_file=$(this).data("url"),image=$(this).data("image"),created_at=$(this).data("created_at"),window.parent.$("#"+field_id+"_box").append('<div class="item" data-delete_box><img src="'+image+'" alt=""><input type="hidden" value="'+url_file+'" name="'+field_id+'[]"><span class="item-delete" data-delete_nocomfirm><i class="fa fa-trash"></i></span></div>'),window.parent.$("#"+field_id+"_box").find(".error").remove()});break;case"editor":$(".item.active").each(function(e){image=$(this).data("image"),title=$(this).data("title"),caption=$(this).data("caption"),str='<div class="tubo-media-item">',str+='<img src="'+image+'" alt="'+title+'">',""!=caption&&(str+="<p>"+caption+"</p>"),str+="</div><p></p>",window.parent.tinyMCE.get(field_id).execCommand("mceInsertContent",!1,str)})}window.parent.$("#media .close").click()})});