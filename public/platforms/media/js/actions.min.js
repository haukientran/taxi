function setDetail(t){str='<p class="image_name">'+t.name+"</p><p>"+text_size+": "+t.size+"</p><p>"+text_created+": "+t.created+"</p><p>"+text_updated+": "+t.updated+'</p><input type="text" name="title" value="'+t.title+'" placeholder="'+text_title+'"><textarea rows="2" name="caption" placeholder="'+text_desc+'">'+t.caption+'</textarea><button type="button" class="btn btn-media btn-active" data-id="'+t.id+'" id="save_info_image">'+text_save+'</button><button type="button" class="btn btn-media" data-id="'+t.id+'" id="check_delete">'+text_delete+"</button>",$(".media-content__main-detail__thumb").empty().append('<img src="'+t.image+'" alt="">'),$(".media-content__main-detail__desc").empty().append(str)}function setDetailEmpty(){$(".media-content__main-detail__thumb").empty().append('<i class="fa fa-image"></i>'),$(".media-content__main-detail__desc").empty().append("<p>"+no_choose_image+"</p>")}function checkEmptyImage(){0==$(".media-content__main-list .item").length&&$(".media-content__main-list").empty().append('<div class="media-content__main-list__upload"><i class="fa fa-cloud-upload icon"></i><label for="file" class="inputfile" files selected">'+no_image+"</label></div>")}function loadModal(t){$("#modal-comfirm .modal-title").empty().text(t.title),$("#modal-comfirm .modal-body").empty().append('<p style="line-height: 22px;">'+t.text+"</p>"),"true"==t.close?$("#modal-comfirm .modal-footer").empty().append('<button type="button" class="btn btn-media btn-active" data-dismiss="modal">'+upload_close+"</button>"):$("#modal-comfirm .modal-footer").empty().append(t.footer),$("#modal-comfirm").modal()}function in_array(t,a){for(var e=!1,i=0;i<a.length;i++)if(a[i]==t){e=!0;break}return e}function upload_file(t){check_size=0,check_extension=0,$.each(t,function(t,a){a.size>max_size_file&&(check_size=1),extension=a.name.substr(a.name.lastIndexOf(".")+1),allowed_image=allowed_extension_image.split(","),allowed_file=allowed_extension_file.split(","),in_array(extension,allowed_array=$.merge(allowed_image,allowed_file))||(check_extension=1)}),1==check_size?(loadModal(data_model={title:upload,text:upload_size_fail,close:"true"}),$("#file").val("")):1==check_extension?(loadModal(data_model={title:upload,text:text=upload_ext_fail+": "+allowed_extension_image+","+allowed_extension_file,close:"true"}),$("#file").val("")):(count=t.length,$(".media-content__main-list__upload").length>0&&$(".media-content__main-list").empty(),count>0&&($.each(t,function(t,a){image_preview=URL.createObjectURL(a),name=a.name,str='<div class="item upload_waiting" data-index="'+t+'"><div class="item-image"><img src="'+image_preview+'" alt=""></div><div class="item-info"><p class="item-info__name">'+name+'</p><p class="item-info__size">'+text_size+": "+(size=formatSizeUnits(a.size))+'</p><p class="item-info__created">'+text_created+": "+(time=getCurentTime())+'</p><p class="item-info__updated">'+text_updated+": "+time+'</p><p class="item-info__created">'+uploading+"</p></div></div>",$(".media-content__main-list").prepend(str)}),data_error=[],id_success=[],$.each(t,function(t,a){var e=new FormData;e.append("files",a),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:url,data:e,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){$(".item[data-index="+t+"]").removeClass("upload_waiting").addClass("uploading")},success:function(a){1==a.status?($(".item[data-index="+t+"]").removeClass("uploading").addClass("upload_success"),id_success.push(a.media_id)):(data_error.push(a.message),$(".item[data-index="+t+"]").removeClass("uploading").addClass("upload_fail"))},error:function(a){text=a.responseJSON.message?a.responseJSON.message:a.responseText,data_error.push(text),$(".item[data-index="+t+"]").removeClass("uploading").addClass("upload_fail")}})}),load_ajax=!1,$(document).ajaxStop(function(){load_ajax=!0}),load_interval=setInterval(function(){!0==load_ajax&&(setTimeout(function(){loadImage(optimizeUrl()),id_success.length>0&&setTimeout(function(){type=getUrlParameter(url,"uploads"),choose_one=!0,"multiple"==type&&(choose_one=!1),!0==choose_one?$(".item[data-id="+id_success[id_success.length-1]+"]").click():$.each(id_success,function(t,a){$(".item[data-id="+a+"]").click()})},1e3)},2e3),load_ajax=!1,clearInterval(load_interval),data_error.length>0&&(str_error="",$.each(data_error,function(t,a){str_error+=a+"<br>"}),loadModal(data_model={title:"Upload Fail",text:str_error,close:"true"})))})),$("#file").val(""))}function loadImage(t){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"GET",url:t,beforeSend:function(){},success:function(a){history.pushState(null,null,t),setLoadFile(a)},error:function(t){alert("C\xf3 lỗi xảy ra!")}})}function loadImageLoading(t){loadAjaxGet(t,{beforeSend:function(){},success:function(a){history.pushState(null,null,t),setLoadFile(a)},error:function(t){}})}function setLoadFile(t){$(".media-content__main-list").empty().append(t.data),$(".media-content__main-pagination").empty().append(t.paginate),setDetailEmpty()}function optimizeUrl(t,a,e){for(var i in param_array=[],search=decodeURI(window.location.search).replace("?","").replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"'),url_param={},""!=search&&(url_param=JSON.parse('{"'+search+'"}')),checkEmpty(t)||(url_param.page=t),checkEmpty(a)||(url_param.filter=a),checkEmpty(e)||(url_param.type=e),url_param)url_param.hasOwnProperty(i)&&param_array.push(encodeURIComponent(i)+"="+encodeURIComponent(url_param[i]));return url_load=url_not_param+"?"+(str_param=param_array.join("&"))}url=window.location.href,url_not_param=window.location.origin+window.location.pathname,uploads=getUrlParameter(url,"uploads"),$(document).ready(function(){loadImageLoading(url),$("body").on("click",".media-content__main-list .item",function(){if($(this).hasClass("upload_waiting")||$(this).hasClass("uploading")||$(this).hasClass("upload_success")||$(this).hasClass("upload_fail"))return!1;$(this).hasClass("active")?($(this).removeClass("active"),setDetailEmpty()):("multiple"!=uploads&&$(".media-content__main-list .item").removeClass("active"),$(this).addClass("active"),id=$(this).data("id"),url_file=$(this).data("url"),image=$(this).data("image"),name=$(this).data("name"),size=$(this).data("size"),created=$(this).data("created"),updated=$(this).data("updated"),setDetail(data={id:id,url_file:url_file,image:image,name:name,size:size,created:created,updated:updated,title:title=$(this).data("title"),caption:caption=$(this).data("caption")}))}),$("body").on("click","*[data-search_btn]",function(t){t.preventDefault(),pushOrUpdate({name:keyword=$("input[name=keyword]").val()}),loadImageLoading(window.location.href)}),$("body").on("click","#check_delete",function(){loadModal(data_model={title:delete_title,text:delete_comfirm,footer:'<button type="button" class="btn btn-media btn-active" data-delete_image data-id="'+(id=$(this).data("id"))+'">'+text_delete+'</button><button type="button" class="btn btn-media" data-dismiss="modal">'+text_no+"</button>"})}),$("body").on("click","*[data-delete_image]",function(){id=$(this).data("id"),$("#modal-comfirm").modal("hide"),item_box=$(".item[data-id="+id+"]"),formData={_token:$('meta[name="csrf-token"]').attr("content"),_method:"DELETE",id:id},LoadAjaxPost(url_not_param+"/"+id,formData,{beforeSend:function(){item_box.addClass("uploading")},success:function(t){item_box.fadeOut(function(){$(this).remove(),checkEmptyImage()})},error:function(t){}})}),$("body").on("click","#save_info_image",function(){id=$(this).data("id"),title=$(this).parent().children("input[name=title]").val(),caption=$(this).parent().children("textarea[name=caption]").val(),$(".item[data-id="+id+"]").data("title",title),$(".item[data-id="+id+"]").data("caption",caption),""!=title?$(".item[data-id="+id+"]").find(".item-info__title").css("display","block").html(text_title+": "+title):$(".item[data-id="+id+"]").find(".item-info__title").css("display","none").html(null),""!=caption?$(".item[data-id="+id+"]").find(".item-info__caption").css("display","block").html(text_desc+": "+caption):$(".item[data-id="+id+"]").find(".item-info__caption").css("display","none").html(null),formData={_token:$('meta[name="csrf-token"]').attr("content"),_method:"PUT",id:id,title:title,caption:caption},LoadAjaxPost(url_not_param+"/"+id,formData,{beforeSend:function(){},success:function(t){loadModal(data_model={title:update_title,text:update_success,close:"true"})},error:function(t){}})}),$("body").on("click",'*[data-type="type"]',function(t){t.preventDefault(),value=$(this).data("value"),$('*[data-type="type"]').removeClass("active"),$(this).addClass("active"),loadImageLoading(url_load=optimizeUrl(null,null,value))}),$("body").on("click",'*[data-type="filter"]',function(t){t.preventDefault(),value=$(this).data("value"),$('*[data-type="filter"]').removeClass("active"),$(this).addClass("active"),loadImageLoading(url_load=optimizeUrl(null,value,null))}),$("body").on("click","*[data-reload]",function(){loadImageLoading(optimizeUrl(null,null,null))}),$("#file").on("change",function(){upload_file(file=this.files)}),$(".media-content__main-list__upload").on("drag dragstart dragend dragover dragenter dragleave drop",function(t){t.preventDefault(),t.stopPropagation()}).on("dragover dragenter",function(){$(".media-content__main-list__upload").addClass("upload_active")}).on("dragleave dragend drop",function(){$(".media-content__main-list__upload").removeClass("upload_active")}).on("drop",function(t){upload_file(droppedFiles=t.originalEvent.dataTransfer.files)}),$(".media-content__main-pagination").on("click","a.page-link",function(t){t.preventDefault(),loadImageLoading(url_load=optimizeUrl(page=getUrlParameter(href=$(this).attr("href"),"page"),null,null))}),$("body").on("click","*[data-insert]",function(){switch(type=getUrlParameter(url,"uploads"),field_id=getUrlParameter(url,"field_id"),type){case"direct":$(".item.active").each(function(t){name=$(this).data("name"),url_file=$(this).data("url"),image=$(this).data("image"),created_at=$(this).data("created_at"),window.parent.$("#"+field_id).attr("src",image),window.parent.$("#input-"+field_id).val(url_file)});break;case"single":$(".item.active").each(function(t){name=$(this).data("name"),url_file=$(this).data("url"),image=$(this).data("image"),created_at=$(this).data("created_at"),window.parent.$("#"+field_id+"_box").empty().append('<div class="item" data-delete_box><img src="'+image+'" alt=""><input type="hidden" value="'+url_file+'" name="'+field_id+'"></div>'),window.parent.$("#"+field_id+"_box").find(".error").remove(),window.parent.$("#image-box-"+field_id).show(),window.parent.$("#image-box-"+field_id).parents(".mb-3").find(".dropzone").hide()});break;case"multiple":$(".item.active").each(function(t){name=$(this).data("name"),url_file=$(this).data("url"),image=$(this).data("image"),created_at=$(this).data("created_at"),window.parent.$("#"+field_id+"_box").append('<div class="item" data-delete_box><img src="'+image+'" alt=""><input type="hidden" value="'+url_file+'" name="'+field_id+'[]"><span class="item-delete" data-delete_nocomfirm><i class="fa fa-trash"></i></span></div>'),window.parent.$("#"+field_id+"_box").find(".error").remove()});break;case"editor":$(".item.active").each(function(t){image=$(this).data("image"),title=$(this).data("title"),caption=$(this).data("caption"),str='<div class="tubo-media-item">',str+='<img src="'+image+'" alt="'+title+'">',""!=caption&&(str+="<p>"+caption+"</p>"),str+="</div><p></p>",window.parent.tinyMCE.get(field_id).execCommand("mceInsertContent",!1,str)});break;case"ckeditor":$(".item.active").each(function(t){image=$(this).data("image"),title=$(this).data("title"),caption=$(this).data("caption"),str='<div class="tubo-media-item">',str+='<img src="'+image+'" alt="'+title+'">',""!=caption&&(str+="<p>"+caption+"</p>"),str+="</div><p></p>";let a=window.parent.editor[field_id];a.model.change(t=>{let e=a.data.processor.toView(str),i=a.data.toModel(e);a.model.insertContent(i,a.model.document.selection)})})}window.parent.$("#media .close").click()})});
